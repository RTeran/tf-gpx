function downloadString(t,o){var e=document.createElement("a");e.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(o)),e.setAttribute("download",t),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)}function errCheck(t){let o="It looks like you're not on a Trailforks.com page.",e="It looks like you're on Trailforks.com, but not looking at a route or trail page.",n="Can't find a map on this Trailforks page. Press OK to go to the page where we think the map lives.\n\nYou'll need to click the bookmarklet again after that page loads to export.";return-1===window.location.hostname.indexOf("trailforks")?(window.alert(o),!1):-1===window.location.pathname.indexOf("trails")&&-1===window.location.pathname.indexOf("route")?(window.alert(e),!1):-1!==t.indexOf("encodedpath")||(confirm(n)?(window.location.href="https://"+document.location.hostname+document.location.pathname+"map/",!1):void 0)}let pageString=document.getElementsByTagName("html")[0].innerHTML;if(errCheck(pageString)){let t=document.title,o=t.split("|")[0].trim(),e="https://"+window.location.hostname+window.location.pathname,n=window.location.pathname.split("/")[2],a=pageString.match(/encodedpath:\s?'(.*?)'/)[1].replaceAll("\\\\","%5C"),i=polyline.decode(a),l="";for(let t of i)l+='\n\t\t\t<trkpt lat="'+t[0]+'" lon="'+t[1]+'"/>';let r='<?xml version="1.0" encoding="UTF-8"?>\n<gpx xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd" version="1.1" xmlns="http://www.topografix.com/GPX/1/1" creator="https://github.com/cosmocatalano/tf-gpx">',d='\n\t<metadata>\n\t\t<link href="'+e+'">\n\t\t\t<text>'+t+"</text>\n\t\t</link>\n\t</metadata>\n\t<trk>\n\t\t<name>"+o+"</name>\n\t\t<trkseg>",c="\n\t\t</trkseg>\n\t</trk>\n</gpx>",m=r+d+l+c,p=m,s=n+".gpx";downloadString(s,p)}